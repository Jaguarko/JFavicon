/*
 * JFavicon - A small library for manipulating the Favicon
 * Str@nnik
 * Copyright (c) 2012 Alex Ivashkin
 * @version 0.1.0
*/

(function(){var a={m:{},init:function(b){a.m.body=document.getElementsByTagName("body")[0];a.m.head=document.getElementsByTagName("head")[0];a.m.fav=document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0];a.m.title=document.getElementsByTagName("title")[0];if("undefined"!=typeof b&&(b.extract&&(window.jf=a),b.fav&&(a.sett.favicon=b.fav),b.style&&(a.sett.currStyle=b.style),b.dir))a.sett.dir=b.dir;document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0]?a.m.fvi=document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0]:(b=document.createElement("link"),b.rel="shortcut icon",b.href=a.sett.favicon,b.type="image/x-icon",a.m.head.appendChild(b));return this},sett:{width:15,height:9,bg:"#000",ct:"#fff",num:null,favicon:"/favicon.png",currStyle:"default",dir:"/"},style:{"default":{title:"default",maxNum:99},main:{title:"main",maxNum:2,ext:".png",pref:"fv"}},setStyle:function(b){"undefined"!=typeof b&&"undefined"==typeof a.style[b.title]&&(a.style[b.title]=b)},set:function(b){"undefined"!=typeof b.width&&(a.sett.width=b.width);"undefined"!=typeof b.height&&(a.sett.height=b.height);"undefined"!=typeof b.bg&&(a.sett.bg=b.bg);"undefined"!=typeof b.ct&&(a.sett.ct=b.ct);"undefined"!=typeof b.num&&(a.sett.num=b.num);return this},draw:function(b){if("default"==a.sett.currStyle){var e=new Image;e.src=document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0].href;e.onload=function(){var d=document.createElement("canvas");d.width=16;d.height=16;var c=d.getContext("2d");c.drawImage(e,0,0);c.fillStyle=a.sett.bg;c.fillRect(1,15-a.sett.height,a.sett.width,a.sett.height);c.fillStyle=a.sett.ct;c.font="normal 8px sans-serif";c.fillText(99>=b?b:"99+",2,13);a.m.head.removeChild(document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0]);c=document.createElement("link");c.rel="shortcut icon";c.href=d.toDataURL();c.type="image/x-icon";a.m.head.appendChild(c)}}else{a.m.head.removeChild(document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0]);var d=document.createElement("link");d.rel="shortcut icon";var f=null;b<=a.style[a.sett.currStyle].maxNum?f=b:f="max";d.href=a.sett.dir+a.sett.currStyle+"/"+a.style[a.sett.currStyle].pref+f+a.style[a.sett.currStyle].ext;d.type="image/x-icon";a.m.head.appendChild(d)}return this}};window.JFavicon=a})();